<!-- views/manag/addevent.ejs -->
<%- include('../partials/header.ejs') %>

<body>
  <div class="container mt-4 p-4">
    <h2>Create New Event</h2>
    <form id="eventForm">
      <div class="mb-3">
        <label for="eventName" class="form-label">Event Name</label>
        <input type="text" class="form-control" id="eventName" name="eventName" required>
      </div>
      <div class="mb-3">
        <label for="details" class="form-label">Details</label>
        <textarea class="form-control" id="details" name="details" rows="3" required></textarea>
      </div>
      <div class="row">
        <div class="col mb-3">
          <label for="totalTickets" class="form-label">Total Tickets</label>
          <input type="number" class="form-control" id="totalTickets" name="totalTickets" required>
        </div>
        <div class="col mb-3">
          <label for="price" class="form-label">Price</label>
          <input type="number" class="form-control" id="price" name="price" required>
        </div>
      </div>
      <div class="row">
        <div class="col mb-3">
          <label for="eventImage" class="form-label">Event Image (IPFS URL Link)</label>
          <input type="url" class="form-control" id="eventImage" name="eventImage" required>
        </div>
        <div class="col mb-3">
          <label for="ticketImage" class="form-label">Ticket Image (IPFS URL Link)</label>
          <input type="url" class="form-control" id="ticketImage" name="ticketImage" required>
        </div>
      </div>
      <button type="submit" class="btn btn-primary mt-2">Create Event</button>
    </form>
  </div>

  <script>
    document.getElementById('eventForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const accounts = await provider.send('eth_requestAccounts', []);
      const eventCreatorAddress = accounts[0];

      const formData = new FormData(e.target);
      formData.append('eventCreatorAddress', eventCreatorAddress);

      const data = Object.fromEntries(formData.entries());

      fetch('/manag/addevent', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Event created successfully!');
          window.location.href = '/events';
        } else {
          alert('Error creating event: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error:', error);
      });
    });
  </script>

</body>

<%- include('../partials/footer.ejs') %>
